<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ansible - OnionRTC</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../Selenium/index.html"><strong aria-hidden="true">2.</strong> Client Setup</a></li><li class="chapter-item expanded "><a href="../../Deployment/index.html"><strong aria-hidden="true">3.</strong> Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Deployment/Ansible/index.html" class="active"><strong aria-hidden="true">3.1.</strong> Ansible</a></li><li class="chapter-item expanded "><a href="../../Deployment/HostA-Application/index.html"><strong aria-hidden="true">3.2.</strong> Host A - Application server</a></li><li class="chapter-item expanded "><a href="../../Deployment/HostB-Turn/index.html"><strong aria-hidden="true">3.3.</strong> Host B - Turn server</a></li><li class="chapter-item expanded "><a href="../../Deployment/HostCD-Router/index.html"><strong aria-hidden="true">3.4.</strong> Host CD - Router</a></li><li class="chapter-item expanded "><a href="../../Deployment/HostsCD-Clients/index.html"><strong aria-hidden="true">3.5.</strong> Hosts CD - Clients</a></li></ol></li><li class="chapter-item expanded "><a href="../../CommandAndControl/index.html"><strong aria-hidden="true">4.</strong> Command And Control</a></li><li class="chapter-item expanded "><a href="../../Dataprocess/index.html"><strong aria-hidden="true">5.</strong> Data Process</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OnionRTC</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ansible"><a class="header" href="#ansible">Ansible</a></h1>
<p>This document describes how to setup Ansible and the plays which is implemented.</p>
<p>The complete list of servers and names can be found in <a href="./inventory.yaml">inventory.yaml</a> but can be summarized to:</p>
<ul>
<li>server-[a-d]</li>
<li>clients
<ul>
<li>c_clients
<ul>
<li>c[1-6]</li>
</ul>
</li>
<li>d_clients
<ul>
<li>d[1-6]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>And can be called by group, list or individually.</p>
<h2 id="installation-and-setup"><a class="header" href="#installation-and-setup">Installation and setup</a></h2>
<p>Read the <a href="https://docs.ansible.com/ansible/latest/getting_started/index.html">getting started documentation</a> or just install with <code>python -m pip install --user ansible</code></p>
<p>If WSL is used it might be required to set the environment variable <code>ANSIBLE_CONFIG</code> to the current directory for it to find the inventory file. Set it with: <code>export ANSIBLE_CONFIG=$PWD</code></p>
<p>There are some plays which requires some updated versions of external collections install them with <code>ansible-galaxy collection install -r</code> Further information can be found in the <a href="https://docs.ansible.com/ansible/latest/collections_guide/collections_installing.html#install-multiple-collections-with-a-requirements-file">documentation</a>.</p>
<blockquote>
<p>NOTE: the requirements installation have not been tested yet.</p>
</blockquote>
<blockquote>
<p>NOTE: All commands is expected to be run from this directory.</p>
</blockquote>
<h2 id="testing-the-setup"><a class="header" href="#testing-the-setup">Testing the setup</a></h2>
<p>Example commands for testing that ansible is working:</p>
<pre><code class="language-shell"># Check the ram usage of the the server A with
ansible server-a -a &quot;free -h&quot;

# Check the hostname of the server
ansible server-c  -m ansible.builtin.setup -a &quot;filter=ansible_hostname&quot;

# Reboot all clients
ansible clients -a &quot;reboot now&quot; -K --become
</code></pre>
<h2 id="ssh-setup"><a class="header" href="#ssh-setup">SSH setup</a></h2>
<p>The client servers are by default accessible through password base authentication, but it can be disabled across all the clients with the following command.</p>
<pre><code class="language-shell">ansible-playbook playbooks/setupSecureSSH.yaml
</code></pre>
<h2 id="ssh-keys"><a class="header" href="#ssh-keys">SSH keys</a></h2>
<p>The key were generated with:</p>
<pre><code class="language-shell">mkdir -p ./playbooks/files/.ssh/

ssh-keygen -f ./playbooks/files/.ssh/id_ecdsa -t ecdsa -b 521 -q -N &quot;&quot; -C Deployment
</code></pre>
<p>The public key is also added to <a href="https://github.com/Master2022E/OnionRTC-experiment/settings/keys">GitHub</a></p>
<p>To send the keys to the remote hosts. (Client hosts C1-C6 and D1-D6) run the command </p>
<pre><code class="language-shell">ansible-playbook playbooks/setupSSHKeys.yaml
</code></pre>
<h2 id="hostname-setup"><a class="header" href="#hostname-setup">Hostname setup</a></h2>
<p>When browsing the servers it can sometimes be hard to know with certainty which server one is using. Therefor we have the hostname's of the servers  defined in the <a href="./inventory.yaml">inventory list</a> where the hostname can be set for each server.</p>
<p><strong>Beware that it will reboot the host!</strong></p>
<pre><code class="language-shell">ansible-playbook playbooks/setupHostname.yaml -K
</code></pre>
<h2 id="setup-apt-package-dependencies"><a class="header" href="#setup-apt-package-dependencies">Setup APT Package Dependencies</a></h2>
<p>Play which installs the required apt dependencies.</p>
<pre><code class="language-shell">ansible-playbook playbooks/setupPackageDependencies.yaml -K
</code></pre>
<h2 id="setup-big-buck-bunny"><a class="header" href="#setup-big-buck-bunny">Setup Big Buck Bunny</a></h2>
<blockquote>
<p>NOTE: Must be run after the git repository have been fetch, else it will fail or need the force option.</p>
</blockquote>
<pre><code class="language-shell">ansible-playbook playbooks/setupBigBuckbunny.yaml
</code></pre>
<p>After this the movie is accessible in <code>~/OnionRTC-experiment/client_scripts/BigBuckBunny.mp4</code>.</p>
<h2 id="git-pull-and-install-pip-requirements"><a class="header" href="#git-pull-and-install-pip-requirements">Git pull and install Pip requirements</a></h2>
<p>To pull the latest code the ssh keys must be distributed first. Afterwards it is possible to pull the latest version of the main branch. The script will also install the pip requirements defined in the requirements file located in the root folder.</p>
<pre><code class="language-shell">ansible-playbook playbooks/updateGit.yaml
</code></pre>
<p>The code will be located in <code>/home/agpbruger/OnionRTC-experiment/</code></p>
<h2 id="cpu-status-information"><a class="header" href="#cpu-status-information">CPU status information</a></h2>
<p>Play which will display top four cpu processes running and how much CPU it consumes.</p>
<pre><code class="language-shell">ansible-playbook playbooks/readCPU.yaml --limit c1
</code></pre>
<blockquote>
<p>NOTE: The -l or --limit flag is currently required and could be: <code>clients</code>, <code>all</code>, <code>c1</code> or any other host/group.</p>
</blockquote>
<h2 id="get-client-logs"><a class="header" href="#get-client-logs">Get client logs</a></h2>
<p>To allow the developers to more easily locate errors the clients will output logging to a file, which then can be reviewed either on the server or locally pulled with a playbook.</p>
<pre><code class="language-shell">ansible-playbook playbooks/getLogs.yaml --limit &quot;c2,d2&quot;
</code></pre>
<p>The logs will here after be located in <code>./playbooks/logs/c2/debug.log</code> and <code>./playbooks/logs/d2/debug.log</code>.</p>
<h2 id="check-for-video-device"><a class="header" href="#check-for-video-device">Check for video device</a></h2>
<p>To check if the video is running on all hosts:</p>
<pre><code class="language-shell">ansible-playbook playbooks/checkForVideoDevice.yaml
</code></pre>
<h2 id="check-servers-ready"><a class="header" href="#check-servers-ready">Check servers ready</a></h2>
<p>Verify that all clients is ready to run, by checking if the services is started and enabled.</p>
<p>The script is still a work in progress.</p>
<ul>
<li>Tor</li>
<li>Lokinet [TODO]</li>
<li>Webcam [TODO]</li>
</ul>
<pre><code class="language-shell">ansible-playbook playbooks/checkClientsReady.yaml
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Deployment/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../Deployment/HostA-Application/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Deployment/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../Deployment/HostA-Application/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
